//*********** IMPORTS *****************
var lr = require('tiny-lr'), // œô¨¼œô¨Øœô¨Ýœô¨Øœô¨Òœô¨Õœô¨Ñœô¨áœô¨Õœô¨àœô¨Òœô¨Õœô¨à œô¨Ôœô¨Ûœô¨ï livereload
    gulp = require('gulp'), // œô¨Áœô¨Þœô¨Þœô¨Ñœô¨áœô¨âœô¨Òœô¨Õœô¨Ýœô¨Ýœô¨Þ Gulp JS
    jade = require('gulp-jade'), // œô¨¿œô¨Ûœô¨Ðœô¨Óœô¨Øœô¨Ý œô¨Ôœô¨Ûœô¨ï Jade
    stylus = require('gulp-stylus'), // œô¨¿œô¨Ûœô¨Ðœô¨Óœô¨Øœô¨Ý œô¨Ôœô¨Ûœô¨ï Stylus
    nib = require('nib'); //œô¨¿œô¨Ûœô¨Ðœô¨Óœô¨Øœô¨Ý nib œô¨Ôœô¨Ûœô¨ï stylus
    livereload = require('gulp-livereload'), // Livereload œô¨Ôœô¨Ûœô¨ï Gulp
    jsmin = require('gulp-jsmin'); // œô¨¼œô¨Øœô¨Ýœô¨Øœô¨äœô¨Øœô¨Úœô¨Ðœô¨æœô¨Øœô¨ï JS
    rename = require('gulp-rename'); //œô¨¿œô¨Õœô¨àœô¨Õœô¨Øœô¨Üœô¨Õœô¨Ýœô¨Þœô¨Òœô¨Úœô¨Ð
    myth = require('gulp-myth'), // œô¨¿œô¨Ûœô¨Ðœô¨Óœô¨Øœô¨Ý œô¨Ôœô¨Ûœô¨ï Myth - http://www.myth.io/
    csso = require('gulp-csso'), // œô¨¼œô¨Øœô¨Ýœô¨Øœô¨äœô¨Øœô¨Úœô¨Ðœô¨æœô¨Øœô¨ï CSS
    imagemin = require('gulp-imagemin'), // œô¨¼œô¨Øœô¨Ýœô¨Øœô¨äœô¨Øœô¨Úœô¨Ðœô¨æœô¨Øœô¨ï œô¨Øœô¨×œô¨Þœô¨Ñœô¨àœô¨Ðœô¨Öœô¨Õœô¨Ýœô¨Øœô¨Ù
    uglify = require('gulp-uglify'), // œô¨¼œô¨Øœô¨Ýœô¨Øœô¨äœô¨Øœô¨Úœô¨Ðœô¨æœô¨Øœô¨ï JS
    concat = require('gulp-concat'), // œô¨Áœô¨Úœô¨Ûœô¨Õœô¨Ùœô¨Úœô¨Ð œô¨äœô¨Ðœô¨Ùœô¨Ûœô¨Þœô¨Ò
    connect = require('connect'), // Webserver
    server = lr();

// œô¨Áœô¨Þœô¨Ñœô¨Øœô¨àœô¨Ðœô¨Õœô¨Ü Stylus
gulp.task('stylus', function() {
    gulp.src('./assets/stylus/*.styl')
        .pipe(stylus({use: [nib()]})) // œô¨áœô¨Þœô¨Ñœô¨Øœô¨àœô¨Ðœô¨Õœô¨Ü stylus
    .on('error', console.log) // œô¨µœô¨áœô¨Ûœô¨Ø œô¨Õœô¨áœô¨âœô¨ì œô¨Þœô¨èœô¨Øœô¨Ñœô¨Úœô¨Ø, œô¨Òœô¨ëœô¨Òœô¨Þœô¨Ôœô¨Øœô¨Ü œô¨Ø œô¨ßœô¨àœô¨Þœô¨Ôœô¨Þœô¨Ûœô¨Öœô¨Ðœô¨Õœô¨Ü
    .pipe(myth()) // œô¨Ôœô¨Þœô¨Ñœô¨Ðœô¨Òœô¨Ûœô¨ïœô¨Õœô¨Ü œô¨ßœô¨àœô¨Õœô¨äœô¨Øœô¨Úœô¨áœô¨ë - http://www.myth.io/
    .pipe(gulp.dest('./public/css/')) // œô¨×œô¨Ðœô¨ßœô¨Øœô¨áœô¨ëœô¨Òœô¨Ðœô¨Õœô¨Ü css
    .pipe(livereload(server)); // œô¨Ôœô¨Ðœô¨Õœô¨Ü œô¨Úœô¨Þœô¨Üœô¨Ðœô¨Ýœô¨Ôœô¨ã œô¨Ýœô¨Ð œô¨ßœô¨Õœô¨àœô¨Õœô¨×œô¨Ðœô¨Óœô¨àœô¨ãœô¨×œô¨Úœô¨ã css
});

// œô¨Áœô¨Þœô¨Ñœô¨Øœô¨àœô¨Ðœô¨Õœô¨Ü html œô¨Øœô¨× Jade
gulp.task('jade', function() {
    gulp.src(['./assets/template/*.jade','!./assets/template/_*.jade'])
        .pipe(jade({
            pretty: true
        }))  // œô¨Áœô¨Þœô¨Ñœô¨Øœô¨àœô¨Ðœô¨Õœô¨Ü Jade œô¨âœô¨Þœô¨Ûœô¨ìœô¨Úœô¨Þ œô¨Ò œô¨ßœô¨Ðœô¨ßœô¨Úœô¨Õ ./assets/template/ œô¨Øœô¨áœô¨Úœô¨Ûœô¨îœô¨çœô¨Ðœô¨ï œô¨äœô¨Ðœô¨Ùœô¨Ûœô¨ë œô¨á _*
        .on('error', console.log) // œô¨µœô¨áœô¨Ûœô¨Ø œô¨Õœô¨áœô¨âœô¨ì œô¨Þœô¨èœô¨Øœô¨Ñœô¨Úœô¨Ø, œô¨Òœô¨ëœô¨Òœô¨Þœô¨Ôœô¨Øœô¨Ü œô¨Ø œô¨ßœô¨àœô¨Þœô¨Ôœô¨Þœô¨Ûœô¨Öœô¨Ðœô¨Õœô¨Ü
    .pipe(gulp.dest('./public/')) // œô¨·œô¨Ðœô¨ßœô¨Øœô¨áœô¨ëœô¨Òœô¨Ðœô¨Õœô¨Ü œô¨áœô¨Þœô¨Ñœô¨àœô¨Ðœô¨Ýœô¨Ýœô¨ëœô¨Õ œô¨äœô¨Ðœô¨Ùœô¨Ûœô¨ë
    .pipe(livereload(server)); // œô¨Ôœô¨Ðœô¨Õœô¨Ü œô¨Úœô¨Þœô¨Üœô¨Ðœô¨Ýœô¨Ôœô¨ã œô¨Ýœô¨Ð œô¨ßœô¨Õœô¨àœô¨Õœô¨×œô¨Ðœô¨Óœô¨àœô¨ãœô¨×œô¨Úœô¨ã œô¨áœô¨âœô¨àœô¨Ðœô¨Ýœô¨Øœô¨æœô¨ë
}); 

//œô¨Áœô¨Þœô¨Ñœô¨Øœô¨àœô¨Ðœô¨Õœô¨Ü JS
gulp.task('js', function() {
    gulp.src('./assets/js/**/*.js')
    .pipe(gulp.dest('./public/js'))
    .pipe(livereload(server)); // œô¨Ôœô¨Ðœô¨Õœô¨Ü œô¨Úœô¨Þœô¨Üœô¨Ðœô¨Ýœô¨Ôœô¨ã œô¨Ýœô¨Ð œô¨ßœô¨Õœô¨àœô¨Õœô¨×œô¨Ðœô¨Óœô¨àœô¨ãœô¨×œô¨Úœô¨ã œô¨áœô¨âœô¨àœô¨Ðœô¨Ýœô¨Øœô¨æœô¨ë
});

// œô¨ºœô¨Þœô¨ßœô¨Øœô¨àœô¨ãœô¨Õœô¨Ü œô¨Ø œô¨Üœô¨Øœô¨Ýœô¨Øœô¨Üœô¨Øœô¨×œô¨Øœô¨àœô¨ãœô¨Õœô¨Ü œô¨Øœô¨×œô¨Þœô¨Ñœô¨àœô¨Ðœô¨Öœô¨Õœô¨Ýœô¨Øœô¨ï
gulp.task('images', function() {
    gulp.src('./assets/img/**/*')
        .pipe(imagemin())
        .pipe(gulp.dest('./public/img'))
});

// œô¨»œô¨Þœô¨Úœô¨Ðœô¨Ûœô¨ìœô¨Ýœô¨ëœô¨Ù œô¨áœô¨Õœô¨àœô¨Òœô¨Õœô¨à œô¨Ôœô¨Ûœô¨ï œô¨àœô¨Ðœô¨×œô¨àœô¨Ðœô¨Ñœô¨Þœô¨âœô¨Úœô¨Ø
gulp.task('http-server', function() {
    connect()
        .use(require('connect-livereload')())
        .use(connect.static('./public'))
        .listen('9000');
    console.log('Server listening on http://localhost:9000');
});

// œô¨·œô¨Ðœô¨ßœô¨ãœô¨áœô¨Ú œô¨áœô¨Õœô¨àœô¨Òœô¨Õœô¨àœô¨Ð œô¨àœô¨Ðœô¨×œô¨àœô¨Ðœô¨Ñœô¨Þœô¨âœô¨Úœô¨Ø gulp watch
gulp.task('watch', function() {
    // œô¨¿œô¨àœô¨Õœô¨Ôœô¨Òœô¨Ðœô¨àœô¨Øœô¨âœô¨Õœô¨Ûœô¨ìœô¨Ýœô¨Ðœô¨ï œô¨áœô¨Ñœô¨Þœô¨àœô¨Úœô¨Ð œô¨ßœô¨àœô¨Þœô¨Õœô¨Úœô¨âœô¨Ð
    gulp.run('stylus');
    gulp.run('jade');
    gulp.run('images');
    gulp.run('js');

    // œô¨¿œô¨Þœô¨Ôœô¨Úœô¨Ûœô¨îœô¨çœô¨Ðœô¨Õœô¨Ü Livereload
    server.listen(35729, function(err) {
        if (err) return console.log(err);
        gulp.watch('assets/stylus/**/*.styl', ['stylus']);
        gulp.watch('assets/template/**/*.jade',['jade']);
        gulp.watch('assets/img/**/*', ['images']);
        gulp.watch('assets/js/**/*', ['js']);
    });
    gulp.run('http-server');
});